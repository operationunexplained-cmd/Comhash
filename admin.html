<!doctype html>

<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ComHash — Neon Admin</title><!-- Firebase --><script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-database-compat.js"></script><!-- Chart.js --><script src="https://cdn.jsdelivr.net/npm/chart.js"></script><style>
  /* Base */
  :root{--bg1:#070317;--bg2:#0b0b1a;--card:#0f1220;--glass:rgba(255,255,255,0.04);--muted:#9fb6c6;--neon:#00ff88;--accent:#6b21ff}
  html,body{height:100%;margin:0;font-family:Inter,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:#e6fff7}
  .app{max-width:1200px;margin:18px auto;padding:18px;}
  header{display:flex;justify-content:space-between;align-items:center;gap:12px}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#00ffd1);display:flex;align-items:center;justify-content:center;font-weight:800;color:#061017;box-shadow:0 8px 30px rgba(107,33,255,0.18)}
  h1{margin:0;font-size:20px}
  .muted{color:var(--muted);font-size:13px}

  /* grid */
  .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:14px;margin-top:16px}
  .card{grid-column:span 12;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 8px 30px rgba(0,0,0,0.5)}
  @media(min-width:880px){.card.col-4{grid-column:span 4}.card.col-3{grid-column:span 3}.card.col-6{grid-column:span 6}.card.col-8{grid-column:span 8}.card.col-9{grid-column:span 9}}

  /* neon stat */
  .stat{background:linear-gradient(90deg,rgba(255,255,255,0.02),transparent);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;gap:6px}
  .stat .val{font-size:20px;font-weight:800;color:var(--neon);text-shadow:0 2px 18px rgba(0,255,136,0.12)}

  /* controls */
  .controls{display:flex;gap:8px;align-items:center}
  input,select,textarea{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:10px;border-radius:8px;color:inherit}
  .btn{padding:10px 12px;border-radius:10px;border:0;cursor:pointer;background:linear-gradient(90deg,var(--neon),#77ffd0);color:#012;font-weight:700;box-shadow:0 8px 24px rgba(0,255,136,0.08)}
  .btn.alt{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
  .danger{background:#ff6b6b;color:#111}

  /* table */
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,0.03);text-align:left;font-size:14px}
  th{color:var(--muted);font-weight:700}

  /* sidebar-less responsive layout - tabs */
  .tabs{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
  .tab{padding:8px 12px;border-radius:999px;background:transparent;border:1px solid rgba(255,255,255,0.03);cursor:pointer}
  .tab.active{background:linear-gradient(90deg,var(--accent),#00ffd1);color:#021;box-shadow:0 8px 26px rgba(107,33,255,0.12)}

  /* modal */
  .modal-back{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(0deg,rgba(0,0,0,0.6),rgba(0,0,0,0.6));z-index:9999}
  .modal{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:18px;border-radius:12px;min-width:320px;border:1px solid rgba(255,255,255,0.04)}

  /* footer */
  footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}

  /* small UI niceties */
  .chip{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.02);font-weight:700;color:var(--muted)}
  .searchRow{display:flex;gap:8px;align-items:center}

  /* neon borders for important elements */
  .neon-border{box-shadow:0 0 36px rgba(0,255,136,0.06),inset 0 0 1px rgba(0,255,136,0.06)}

  /* responsive tweaks */
  @media(max-width:680px){.grid{grid-template-columns:repeat(6,1fr)}.card.col-4{grid-column:span 6}.card.col-3{grid-column:span 6}}
</style></head>
<body>
<div class="app">
  <header>
    <div class="brand">
      <div class="logo">C</div>
      <div>
        <h1>ComHash — Neon Admin</h1>
        <div class="muted">Gaming UI • Neon Green accent • Full Realtime DB</div>
      </div>
    </div>
    <div class="controls">
      <div id="adminTag" class="muted">Not logged in</div>
      <button id="darkToggle" class="btn alt">Toggle Theme</button>
      <button id="logoutBtn" class="btn alt" style="display:none">Logout</button>
    </div>
  </header>  <!-- tabs -->  <div class="tabs" id="tabsContainer">
    <div class="tab active" data-page="dashboard">Dashboard</div>
    <div class="tab" data-page="users">Users</div>
    <div class="tab" data-page="missions">Missions</div>
    <div class="tab" data-page="ads">Ads</div>
    <div class="tab" data-page="loot">Recent Loot</div>
    <div class="tab" data-page="charts">Charts</div>
  </div>  <div class="grid" style="margin-top:14px">
    <!-- Dashboard stats -->
    <div class="card col-4" id="dashboardCard">
      <div class="stat"><div class="muted">Total Users</div><div class="val" id="statUsers">0</div></div>
    </div>
    <div class="card col-4">
      <div class="stat"><div class="muted">Active Today</div><div class="val" id="statActive">0</div></div>
    </div>
    <div class="card col-4">
      <div class="stat"><div class="muted">Total TOK</div><div class="val" id="statBalance">0</div></div>
    </div><!-- content card full width -->
<div class="card col-12" id="pageContent">
  <!-- pages will be injected here -->
  <div id="dashboard" class="pageView">
    <h3>Overview</h3>
    <div class="muted">Realtime snapshot of your game economy and users.</div>
    <div style="margin-top:12px;display:grid;grid-template-columns:1fr 1fr;gap:12px">
      <div class="card neon-border"><h4>Top 5 Balances</h4><ol id="topBalances"></ol></div>
      <div class="card neon-border"><h4>Recent Events</h4><div id="recentEvents"></div></div>
    </div>
  </div>

  <div id="users" class="pageView hidden">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
      <div class="searchRow" style="flex:1">
        <input id="userSearch" placeholder="Search by id or username" style="flex:1" />
        <button class="btn" id="searchBtn">Search</button>
      </div>
      <div style="display:flex;gap:8px">
        <button class="btn alt" id="loadAllBtn">Load All</button>
        <button class="btn" id="exportBtn">Export CSV</button>
      </div>
    </div>

    <div style="margin-top:12px;overflow:auto;max-height:420px">
      <table><thead><tr><th>Player ID</th><th>Username</th><th>Balance</th><th>Score</th><th>Taps</th><th>Actions</th></tr></thead>
        <tbody id="usersTbody"></tbody>
      </table>
    </div>
  </div>

  <div id="missions" class="pageView hidden">
    <h3>Missions Editor</h3>
    <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
      <input id="missionTitle" placeholder="Mission title" />
      <input id="missionReward" placeholder="Reward TOK" type="number" />
      <button class="btn" id="addMissionBtn">Add Mission</button>
    </div>
    <div style="margin-top:12px" id="missionsList"></div>
  </div>

  <div id="ads" class="pageView hidden">
    <h3>Ads Manager</h3>
    <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
      <input id="moneytagZone" placeholder="MoneyTag zone id (e.g. 10199103)" />
      <button class="btn" id="saveZoneBtn">Save</button>
    </div>
    <div style="margin-top:12px"><strong>Current Zone:</strong> <span id="currentZone">-</span></div>
  </div>

  <div id="loot" class="pageView hidden">
    <h3>Recent Loot</h3>
    <div id="lootList" style="max-height:420px;overflow:auto;margin-top:8px"></div>
  </div>

  <div id="charts" class="pageView hidden">
    <h3>Realtime Charts</h3>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:8px">
      <div class="card"><canvas id="chartUsers"></canvas></div>
      <div class="card"><canvas id="chartTaps"></canvas></div>
    </div>
  </div>
</div>

  </div>  <footer>ComHash Admin • Neon UI — Replace Firebase config before use</footer>
</div><!-- modal container --><div id="modalBack" class="modal-back"><div class="modal" id="modalContent"></div></div><script>
// ===== CONFIG - replace with your Firebase Realtime DB config =====
const FIREBASE_CONFIG = {
  apiKey: "AIzaSyBDovmAk88JUEjeY35T-3eIta1igiE5fQ0",
  authDomain: "comhashgame.firebaseapp.com",
  databaseURL: "https://comhashgame-default-rtdb.firebaseio.com",
  projectId: "comhashgame",
  storageBucket: "comhashgame.appspot.com",
  messagingSenderId: "392187080052",
  appId: "1:392187080052:web:3e31391442ca1315dc1021"
};
const ADMIN_USERNAME = 'admin';
const ADMIN_PASSWORD = 'Arshad@123';
// ==================================================================

// UI helpers
const $ = id => document.getElementById(id);
function showToast(msg){ const d = document.createElement('div'); d.textContent = msg; d.style.cssText='position:fixed;right:18px;bottom:18px;background:#021; color:var(--neon);padding:10px;border-radius:8px;box-shadow:0 8px 24px rgba(0,255,136,0.08)'; document.body.appendChild(d); setTimeout(()=>d.remove(),3000); }

// Init firebase
firebase.initializeApp(FIREBASE_CONFIG);
const db = firebase.database();

// Page switching
const tabs = document.querySelectorAll('.tab');
const pageViews = document.querySelectorAll('.pageView');
tabs.forEach(t=> t.addEventListener('click', ()=>{
  tabs.forEach(x=>x.classList.remove('active'));
  t.classList.add('active');
  const page = t.dataset.page;
  pageViews.forEach(p=>p.classList.add('hidden'));
  document.getElementById(page).classList.remove('hidden');
}));

// Modal
const modalBack = $('modalBack'); function showModal(html){ $('modalContent').innerHTML = html; modalBack.style.display='flex'; }
modalBack.addEventListener('click', (e)=>{ if(e.target===modalBack) modalBack.style.display='none'; });

// Auth (simple client-side)
let adminLogged = false;
function attemptAutoLogin(){ // nothing automatic - require manual login to avoid accidental exposure
}

// show login prompt on first load
(async function initialLogin(){
  const user = prompt('Admin username:');
  const pass = prompt('Admin password:');
  if(user===ADMIN_USERNAME && pass===ADMIN_PASSWORD){
    $('adminTag').textContent = 'Admin • ' + ADMIN_USERNAME;
    $('logoutBtn').style.display = 'inline-block'; adminLogged = true;
    attachRealtime();
  } else {
    alert('Invalid admin credentials — reload to try again');
  }
})();
$('logoutBtn').addEventListener('click', ()=>{ location.reload(); });

// ===== Realtime handlers =====
async function attachRealtime(){
  // stats
  db.ref('users').on('value', snap=>{
    const val = snap.val()||{}; const list = Object.values(val||{});
    $('statUsers').textContent = list.length;
    let totalBal = 0, active=0;
    const now = Date.now();
    list.forEach(u=>{ totalBal += Number(u.balance||0); if((u.updatedAt||0) > now - 24*3600*1000) active++; });
    $('statBalance').textContent = totalBal; $('statActive').textContent = active;
    renderTopBalances(list);
    renderUsersTable(list);
  });

  db.ref('lootHistory').limitToLast(200).on('value', snap=>{
    const arr = [];
    snap.forEach(s=>arr.push(s.val()));
    renderRecentEvents(arr.slice().reverse());
    renderLoot(arr.slice().reverse());
  });

  db.ref('missions').on('value', snap=>{
    renderMissions(snap.val()||{});
  });

  db.ref('ads').on('value', snap=>{
    const d = snap.val()||{}; $('currentZone').textContent = d.zone || '-';
    $('moneytagZone').value = d.zone || '';
  });

  // charts
  setupCharts();
}

// ===== Users table =====
function renderUsersTable(list){
  const tbody = $('usersTbody'); tbody.innerHTML = '';
  list.sort((a,b)=>Number(b.balance||0)-Number(a.balance||0));
  list.forEach(u=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${u.playerId||''}</td><td>${u.username||''}</td><td>${u.balance||0}</td><td>${u.score||0}</td><td>${u.totalTaps||0}</td><td></td>`;
    const actions = tr.querySelector('td:last-child');
    const ban = document.createElement('button'); ban.className='btn alt'; ban.textContent = u.banned? 'Unban':'Ban'; ban.onclick = ()=> toggleBan(u.playerId,u.banned);
    const edit = document.createElement('button'); edit.className='btn'; edit.style.marginLeft='8px'; edit.textContent='Edit'; edit.onclick = ()=> openEditUser(u);
    actions.appendChild(ban); actions.appendChild(edit);
    tbody.appendChild(tr);
  });
}

function toggleBan(id, currently){ if(!confirm(`${currently? 'Unban':'Ban'} ${id}?`)) return; db.ref('users/'+id).update({ banned: !currently, updatedAt: Date.now() }); }

function openEditUser(u){ showModal(`<h3>Edit ${u.playerId}</h3><p>Username: <input id='mUser' value='${u.username||''}'></p><p>Balance: <input id='mBal' value='${u.balance||0}' type='number'></p><p>Score: <input id='mScore' value='${u.score||0}' type='number'></p><div style='display:flex;gap:8px'><button id='saveUser' class='btn'>Save</button><button id='closeM' class='btn alt'>Close</button></div>`);
  $('closeM').onclick = ()=> modalBack.style.display='none';
  $('saveUser').onclick = async ()=>{
    const username = $('mUser').value; const balance = Number($('mBal').value||0); const score = Number($('mScore').value||0);
    await db.ref('users/'+u.playerId).update({ username, balance, score, updatedAt: Date.now() });
    modalBack.style.display='none'; showToast('User updated');
  };
}

// search
$('searchBtn').addEventListener('click', ()=>{ const q = $('userSearch').value.trim(); if(!q) return; db.ref('users').orderByChild('username').equalTo(q).once('value').then(s=>{ if(s.exists()){ renderUsersTable(Object.values(s.val())); } else { db.ref('users/'+q).get().then(r=>{ if(r.exists()) renderUsersTable([r.val()]); else alert('Not found') }); } }); });
$('loadAllBtn').addEventListener('click', ()=>{ db.ref('users').once('value').then(s=>renderUsersTable(Object.values(s.val()||{}))); });
$('exportBtn').addEventListener('click', async ()=>{ const snap = await db.ref('users').once('value'); const data = snap.val()||{}; const rows = Object.values(data).map(u=>`${u.playerId},${u.username},${u.balance||0},${u.score||0}`); const csv = 'id,username,balance,score
'+rows.join('
'); const blob = new Blob([csv],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url;a.download='users.csv';a.click(); URL.revokeObjectURL(url); });

// ===== Top balances & events =====
function renderTopBalances(list){ const el = $('topBalances'); el.innerHTML=''; list.sort((a,b)=>Number(b.balance||0)-Number(a.balance||0)).slice(0,5).forEach(u=> el.innerHTML += `<li>${u.username||u.playerId}: ${u.balance||0} TOK</li>`); }
function renderRecentEvents(arr){ const el = $('recentEvents'); el.innerHTML = ''; arr.slice(0,6).forEach(it=> el.innerHTML += `<div class='muted'>${new Date(it.ts||0).toLocaleString()} — ${it.playerId} +${it.amount} (${it.reason})</div>`); }

// ===== Missions =====
$('addMissionBtn').addEventListener('click', async ()=>{ const t = $('missionTitle').value.trim(); const r = Number($('missionReward').value||0); if(!t) return alert('Title required'); const id = 'm_'+Date.now().toString(36); await db.ref('missions/'+id).set({ id, title:t, reward:r, createdAt: Date.now() }); $('missionTitle').value=''; $('missionReward').value=''; showToast('Mission added'); });
function renderMissions(obj){ const wrap = $('missionsList'); wrap.innerHTML=''; Object.values(obj||{}).forEach(m=>{ const d = document.createElement('div'); d.className='card'; d.innerHTML = `<div style='display:flex;justify-content:space-between;align-items:center'><div><strong>${m.title}</strong><div class='muted'>Reward: ${m.reward} TOK</div></div><div><button class='btn' data-id='${m.id}'>Edit</button> <button class='btn danger' data-del='${m.id}'>Delete</button></div></div>`; wrap.appendChild(d); }); wrap.querySelectorAll('button[data-id]').forEach(b=> b.onclick=()=>{ const id=b.dataset.id; const newT=prompt('New title'); const newR=Number(prompt('New reward','50')||0); if(newT) db.ref('missions/'+id).update({ title:newT, reward:newR }); }); wrap.querySelectorAll('button[data-del]').forEach(b=> b.onclick=()=>{ const id=b.dataset.del; if(confirm('Delete mission?')) db.ref('missions/'+id).remove(); }); }

// ===== Loot =====
function renderLoot(arr){ const wrap = $('lootList'); wrap.innerHTML=''; arr.forEach(l=>{ const d = document.createElement('div'); d.className='card'; d.innerHTML = `<div style='display:flex;justify-content:space-between'><div><strong>${l.playerId}</strong></div><div>${new Date(l.ts||0).toLocaleString()}</div></div><div style='margin-top:8px'>+${l.amount} TOK — ${l.reason}</div><div style='margin-top:8px'><button class='btn danger'>Revoke</button></div>`; wrap.appendChild(d); }); }

// ===== Ads manager =====
$('saveZoneBtn').addEventListener('click', ()=>{ const z = $('moneytagZone').value.trim(); if(!z) return alert('Zone required'); db.ref('ads').update({ zone:z }); showToast('Zone saved'); });

// ===== Charts =====
let chartUsers, chartTaps;
function setupCharts(){ const ctxU = $('chartUsers').getContext('2d'); const ctxT = $('chartTaps').getContext('2d'); chartUsers = new Chart(ctxU,{type:'line',data:{labels:[],datasets:[{label:'New Users',data:[],borderColor: 'rgba(0,255,136,0.9)',backgroundColor:'rgba(0,255,136,0.12)',fill:true}]},options:{responsive:true}});
 chartTaps = new Chart(ctxT,{type:'bar',data:{labels:[],datasets:[{label:'Taps',data:[],backgroundColor:'rgba(107,33,255,0.6)'}]},options:{responsive:true}});
 // build from simple aggregates
 db.ref('analytics/users').on('value', s=>{ const v = s.val()||{}; chartUsers.data.labels = Object.keys(v); chartUsers.data.datasets[0].data = Object.values(v); chartUsers.update(); });
 db.ref('analytics/taps').on('value', s=>{ const v = s.val()||{}; chartTaps.data.labels = Object.keys(v); chartTaps.data.datasets[0].data = Object.values(v); chartTaps.update(); });
}

// init charts later once connected

// ===== initial helper operations =====
function renderRecentSample(){ /* placeholder for UX */ }

// Attach realtime on login
// attachRealtime called earlier in initialLogin

</script></body>
</html>
