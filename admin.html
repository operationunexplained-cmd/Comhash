<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ComHash Admin</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #0f0f0f;
        color: #fff;
        margin: 0;
        padding: 0;
    }
    h2 {
        text-align: center;
        margin-top: 20px;
    }
    .container {
        width: 95%;
        margin: auto;
        margin-top: 20px;
        background: #1a1a1a;
        padding: 15px;
        border-radius: 10px;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }
    th, td {
        padding: 10px;
        border-bottom: 1px solid #333;
        text-align: left;
    }
    th {
        background: #111;
    }
    button {
        padding: 6px 12px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        color: #fff;
    }
    .edit-btn { background: #007bff; }
    .ban-btn { background: #ff3b3b; }
    .unban-btn { background: #4caf50; }
</style>
</head>
<body>

<h2>ComHash Admin Panel</h2>

<div class="container">
    <h3>All Users</h3>
    <table id="usersTable">
        <tr>
            <th>User ID</th>
            <th>Score</th>
            <th>Banned</th>
            <th>Actions</th>
        </tr>
    </table>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBDovmAk88JUEjeY35T-3eIta1igiE5fQ0",
  authDomain: "comhashgame.firebaseapp.com",
  databaseURL: "https://comhashgame-default-rtdb.firebaseio.com",
  projectId: "comhashgame",
  storageBucket: "comhashgame.firebasestorage.app",
  messagingSenderId: "392187080052",
  appId: "1:392187080052:web:3e31391442ca1315dc1021",
  measurementId: "G-0YWTXYJ7RN"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const usersTable = document.getElementById("usersTable");

function loadUsers() {
    const usersRef = ref(db, "users");

    onValue(usersRef, (snapshot) => {
        const data = snapshot.val();
        usersTable.innerHTML = `
            <tr>
                <th>User ID</th>
                <th>Score</th>
                <th>Banned</th>
                <th>Actions</th>
            </tr>
        `;

        if (!data) return;

        Object.keys(data).forEach(uid => {
            const user = data[uid];
            const row = document.createElement("tr");

            row.innerHTML = `
                <td>${uid}</td>
                <td>${user.score || 0}</td>
                <td>${user.banned ? "Yes" : "No"}</td>
                <td>
                    <button class='edit-btn' onclick='editScore("${uid}", ${user.score || 0})'>Edit</button>
                    ${
                        user.banned 
                        ? `<button class='unban-btn' onclick='banUser("${uid}", false)'>Unban</button>`
                        : `<button class='ban-btn' onclick='banUser("${uid}", true)'>Ban</button>`
                    }
                </td>
            `;

            usersTable.appendChild(row);
        });
    });
}

window.editScore = function(uid, oldScore) {
    const newScore = prompt("Enter new score:", oldScore);
    if (newScore === null || isNaN(newScore)) return;

    update(ref(db, "users/" + uid), { score: Number(newScore) });
};

window.banUser = function(uid, state) {
    update(ref(db, "users/" + uid), { banned: state });
    alert(state ? "User Banned!" : "User Unbanned!");
};

loadUsers();
</script>

</body>
</html>
