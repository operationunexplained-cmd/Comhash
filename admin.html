<!DOCTYPE html>
<html>
<head>
    <title>ComHash Admin Panel</title>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body { margin:0; font-family:Arial; background:#0d1117; color:white; }

        .login-box {
            max-width:350px; margin:50px auto; padding:20px;
            background:#161b22; border-radius:12px;
        }

        input, button, select {
            padding:10px; width:100%; margin:8px 0;
            border:none; border-radius:6px; font-size:15px;
        }

        input { background:#0d1117; color:white; }
        button { background:#238636; color:white; font-weight:bold; }
        button.red { background:#d32626; }
        .nav { display:flex; background:#161b22; padding:10px; }
        .nav button { flex:1; margin: 0 5px; background:#21262d; }

        .section { display:none; padding:15px; }
        .card {
            background:#161b22; padding:15px; border-radius:10px; margin:10px 0;
        }

        .toggle { position:absolute; top:10px; right:10px; }
    </style>
</head>

<body>

<button class="toggle" onclick="toggleDark()">Dark Mode</button>

<!-- LOGIN -->
<div id="loginPage" class="login-box">
    <h2>Admin Login</h2>

    <input id="adminUser" placeholder="Username">
    <input id="adminPass" placeholder="Password" type="password">

    <button onclick="adminLogin()">Login</button>
    <p id="loginError" style="color:red;"></p>
</div>

<!-- DASHBOARD -->
<div id="adminPanel" style="display:none;">

    <div class="nav">
        <button onclick="show('users')">Users</button>
        <button onclick="show('missions')">Missions</button>
        <button onclick="show('loot')">Recent Loot</button>
        <button onclick="show('ads')">Ads</button>
        <button onclick="show('charts')">Analytics</button>
    </div>

    <!-- USERS -->
    <div id="users" class="section">
        <h2>User Manager</h2>

        <input id="searchID" placeholder="Enter Telegram ID">
        <button onclick="searchUser()">Search</button>

        <div id="userResult"></div>
    </div>

    <!-- MISSIONS -->
    <div id="missions" class="section">
        <h2>Missions Editor</h2>

        <input id="missionName" placeholder="Mission Name">
        <input id="missionReward" type="number" placeholder="Reward">

        <button onclick="addMission()">Add Mission</button>

        <h3>All Missions</h3>
        <div id="missionsList"></div>
    </div>

    <!-- RECENT LOOT -->
    <div id="loot" class="section">
        <h2>Recent Loot</h2>
        <div id="lootList"></div>
    </div>

    <!-- ADS -->
    <div id="ads" class="section">
        <h2>Ads Manager</h2>

        <input id="zoneID" placeholder="MoneyTag Zone ID">
        <button onclick="saveZone()">Save</button>

        <p>Current Zone: <span id="currentZone"></span></p>
    </div>

    <!-- ANALYTICS -->
    <div id="charts" class="section">
        <h2>Analytics</h2>

        <canvas id="usersChart"></canvas>
        <canvas id="earnChart"></canvas>
    </div>

</div>

<script>
/* --------------------------------------------------
   ADMIN LOGIN
-------------------------------------------------- */
const ADMIN_USERNAME = "admin";
const ADMIN_PASSWORD = "Arshad@123";

function adminLogin() {
    let u = adminUser.value;
    let p = adminPass.value;

    if (u === ADMIN_USERNAME && p === ADMIN_PASSWORD) {
        loginPage.style.display = "none";
        adminPanel.style.display = "block";
        loadAll();
    } else {
        loginError.innerText = "Invalid Credentials";
    }
}

/* --------------------------------------------------
   DARK MODE
-------------------------------------------------- */
function toggleDark() {
    if (document.body.style.background === "white") {
        document.body.style.background = "#0d1117";
        document.body.style.color = "white";
    } else {
        document.body.style.background = "white";
        document.body.style.color = "black";
    }
}

/* --------------------------------------------------
   FIREBASE CONFIG
-------------------------------------------------- */
const firebaseConfig = {
    apiKey: "AIzaSyBDovmAk88JUEjeY35T-3eIta1igiE5fQ0",
    authDomain: "comhashgame.firebaseapp.com",
    databaseURL: "https://comhashgame-default-rtdb.firebaseio.com",
    projectId: "comhashgame",
    storageBucket: "comhashgame.firebasestorage.app",
    messagingSenderId: "392187080052",
    appId: "1:392187080052:web:3e31391442ca1315dc1021",
    measurementId: "G-0YWTXYJ7RN"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* --------------------------------------------------
   SECTION SWITCHER
-------------------------------------------------- */
function show(sec) {
    document.querySelectorAll(".section").forEach(s => s.style.display = "none");
    document.getElementById(sec).style.display = "block";
}

/* --------------------------------------------------
   USERS
-------------------------------------------------- */
function searchUser() {
    let id = searchID.value;
    if (!id) return alert("Enter ID");

    db.ref("users/" + id).once("value", snap => {
        if (!snap.exists()) {
            userResult.innerHTML = "<p>No user found</p>";
            return;
        }

        let u = snap.val();

        userResult.innerHTML = `
            <div class='card'>
                <p><b>ID:</b> ${id}</p>
                <p><b>Balance:</b> ${u.balance || 0}</p>
                <p><b>Banned:</b> ${u.banned ? "YES" : "NO"}</p>

                <input id="newBal" type="number" placeholder="New Balance">
                <button onclick="updateBalance('${id}')">Update Balance</button>

                <button class="red" onclick="banUser('${id}')">Ban</button>
                <button onclick="unbanUser('${id}')">Unban</button>
            </div>
        `;
    });
}

function updateBalance(id) {
    db.ref("users/" + id).update({
        balance: Number(newBal.value)
    });
    alert("Balance Updated");
}

function banUser(id) {
    db.ref("users/" + id).update({ banned: true });
    alert("User Banned");
}

function unbanUser(id) {
    db.ref("users/" + id).update({ banned: false });
    alert("User Unbanned");
}

/* --------------------------------------------------
   MISSIONS
-------------------------------------------------- */
function addMission() {
    let name = missionName.value;
    let reward = Number(missionReward.value);

    db.ref("missions").push({ name, reward });
    alert("Mission Added");
}

function loadMissions() {
    db.ref("missions").on("value", snap => {
        let html = "";
        snap.forEach(m => {
            let d = m.val();
            html += `
                <div class='card'>
                    <p><b>${d.name}</b></p>
                    <p>Reward: ${d.reward}</p>
                    <button class="red" onclick="delMission('${m.key}')">Delete</button>
                </div>
            `;
        });
        missionsList.innerHTML = html;
    });
}

function delMission(id) {
    db.ref("missions/" + id).remove();
}

/* --------------------------------------------------
   RECENT LOOT
-------------------------------------------------- */
function loadLoot() {
    db.ref("loot").limitToLast(100).on("value", snap => {
        let html = "";
        snap.forEach(l => {
            let d = l.val();
            html += `
                <div class='card'>
                    <p><b>User:</b> ${d.user}</p>
                    <p><b>Amount:</b> ${d.amount}</p>
                    <p>${new Date(d.time).toLocaleString()}</p>
                </div>
            `;
        });
        lootList.innerHTML = html;
    });
}

/* --------------------------------------------------
   ADS MANAGER
-------------------------------------------------- */
function saveZone() {
    db.ref("ads").update({
        zone: zoneID.value
    });
    alert("Zone Updated");
}

function loadZone() {
    db.ref("ads/zone").on("value", snap => {
        currentZone.innerText = snap.val() || "Not Set";
    });
}

/* --------------------------------------------------
   CHARTS
-------------------------------------------------- */
let usersChart, earnChart;

function loadCharts() {
    usersChart = new Chart(document.getElementById("usersChart"), {
        type: "line",
        data: { labels: [], datasets: [{ label: "Users", data: [] }] }
    });

    earnChart = new Chart(document.getElementById("earnChart"), {
        type: "line",
        data: { labels: [], datasets: [{ label: "Earnings", data: [] }] }
    });

    db.ref("stats/users").on("value", snap => {
        let d = snap.val() || {};
        usersChart.data.labels = Object.keys(d);
        usersChart.data.datasets[0].data = Object.values(d);
        usersChart.update();
    });

    db.ref("stats/earn").on("value", snap => {
        let d = snap.val() || {};
        earnChart.data.labels = Object.keys(d);
        earnChart.data.datasets[0].data = Object.values(d);
        earnChart.update();
    });
}

/* --------------------------------------------------
   LOAD ALL
-------------------------------------------------- */
function loadAll() {
    loadMissions();
    loadLoot();
    loadZone();
    loadCharts();
}
</script>

</body>
</html>
