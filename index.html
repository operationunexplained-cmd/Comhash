<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hacker Tapper â€” Simple</title>
  <style>
    body{font-family:Arial;background:#fafafa;color:#111;margin:0;padding:18px;display:flex;justify-content:center}
    .wrap{width:420px;background:#fff;border-radius:10px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,0.06)}
    h1{margin:0 0 8px;font-size:20px}
    .muted{color:#666;font-size:13px}
    .hud{display:flex;gap:8px;margin:12px 0}
    .stat{flex:1;background:#f5f7fb;border-radius:8px;padding:10px;text-align:center}
    .big{font-weight:800;font-size:18px;color:#0b8457}
    #hackArea{height:120px;background:#f0f6f4;border-radius:8px;padding:8px;font-family:monospace;overflow:auto}
    .controls{display:flex;gap:8px;margin-top:12px}
    button{padding:10px 12px;border-radius:8px;border:0;cursor:pointer}
    #tapBtn{background:#0b8457;color:#fff;font-weight:800;flex:1}
    .small{background:transparent;border:1px solid #e0e8e6;color:#0b8457;border-radius:8px;padding:8px}
    .notice{background:#fff4e5;border:1px solid #ffe1b8;padding:8px;border-radius:8px;margin-top:12px;color:#663c00}
  </style>
</head>
<body>
  <div class="wrap" id="app">
    <h1>ðŸ’» Hacker Tapper</h1>
    <div class="muted">Simple UI â€” TAP, WATCH, CLAIM</div>

    <div class="hud">
      <div class="stat"><div class="muted">Balance</div><div id="balance" class="big">0</div></div>
      <div class="stat"><div class="muted">Score</div><div id="score" class="big">0</div></div>
      <div class="stat"><div class="muted">Taps</div><div id="taps" class="big">0</div></div>
    </div>

    <div id="hackArea">Welcome â€” press TAP to start hacking.</div>

    <div class="controls">
      <button id="tapBtn">TAP TO INJECT</button>
      <button id="watchAdBtn" class="small">Watch Ad</button>
    </div>

    <div style="display:flex;gap:8px;margin-top:10px;align-items:center">
      <button id="missionBtn" class="small">Claim Test Mission</button>
      <div style="margin-left:auto" class="muted">Referral: <span id="refLink">-</span></div>
    </div>

    <div id="tgNotice" class="notice hidden"></div>
  </div>

  <!-- SDK -->
  <script src="//libtl.com/sdk.js" data-zone="10199103" data-sdk="show_10199103"></script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-database-compat.js"></script>

  <script>

  const firebaseConfig = {
    apiKey: "AIzaSyBDovmAk88JUEjeY35T-3eIta1igiE5fQ0",
    authDomain: "comhashgame.firebaseapp.com",
    databaseURL: "https://comhashgame-default-rtdb.firebaseio.com",
    projectId: "comhashgame",
    storageBucket: "comhashgame.firebasestorage.app",
    messagingSenderId: "392187080052",
    appId: "1:392187080052:web:3e31391442ca1315dc1021"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const usersRef = db.ref("users");

  const $ = id => document.getElementById(id);

  /************************************
   REAL MODE + TEST MODE AUTO HANDLING
  *************************************/
  const tg = window.Telegram?.WebApp || null;
  const tgUser = tg?.initDataUnsafe?.user || null;

  let playerId, playerName;

  if (tgUser && tgUser.id) {
      // REAL TELEGRAM USER
      playerId = "tg_" + tgUser.id;
      playerName = tgUser.first_name || "Player";
      $("tgNotice").classList.add("hidden");
  } else {
      // TEST MODE â€” for Chrome/Browser
      playerId = "test_" + (Math.floor(Math.random()*900000)+100000);
      playerName = "TestUser";
      $("tgNotice").textContent = "TEST MODE ENABLED â€” NOT INSIDE TELEGRAM";
      $("tgNotice").classList.remove("hidden");
  }

  $("refLink").textContent = "https://t.me/comhash_bot?start=ref_" + playerId;

  let balance = 0, score = 0, taps = 0;

  /********************
   INIT USER IN DB
  *********************/
  usersRef.child(playerId).once("value").then(snap => {
      if (!snap.exists()) {
          usersRef.child(playerId).set({
              playerId,
              username: playerName,
              balance: 0,
              score: 0,
              totalTaps: 0,
              createdAt: Date.now()
          });
      } else {
          const d = snap.val();
          balance = d.balance || 0;
          score = d.score || 0;
          taps = d.totalTaps || 0;
      }
      render();
  });

  usersRef.child(playerId).on("value", s => {
      if (!s.exists()) return;
      const d = s.val();
      balance = d.balance || 0;
      score = d.score || 0;
      taps = d.totalTaps || 0;
      render();
  });

  function render() {
      $("balance").textContent = balance;
      $("score").textContent = score;
      $("taps").textContent = taps;
  }

  /********************
   TAP BUTTON
  *********************/
  $("tapBtn").onclick = async () => {
      score += 1;
      taps += 1;
      if (taps % 5 === 0) balance += 1;
      render();
      push("> injected +1");

      usersRef.child(playerId).update({
          score, totalTaps: taps, balance
      });
  };

  /********************
    WATCH AD
  *********************/
  function push(t) {
      const el = document.createElement("div");
      el.textContent = t;
      $("hackArea").appendChild(el);
  }

  $("watchAdBtn").onclick = async () => {
      balance += 50;
      render();
      push("Ad reward +50 TOK");
      usersRef.child(playerId).update({ balance });
  };

  /********************
    MISSION
  *********************/
  $("missionBtn").onclick = async () => {
      balance += 100;
      render();
      alert("Mission Claimed +100 TOK");
      usersRef.child(playerId).update({ balance });
  };

  </script>
</body>
</html>
