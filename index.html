<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Basic Login System</title>
<style>
    body { font-family: Arial; background: #f5f5f5; display: flex; justify-content: center; padding-top: 50px; }
    #box { width: 320px; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px #ccc; }
    input, button { width: 100%; padding: 10px; margin-top: 10px; border-radius: 6px; border: 1px solid #ccc; }
    #dashboard { display: none; }
</style>
</head>
<body>

<div id="box">

    <div id="login">
        <h2>Login</h2>
        <input id="email" placeholder="Email" type="email">
        <input id="pass" placeholder="Password" type="password">
        <button id="loginBtn">Login</button>
        <button id="signupBtn" style="background:#4CAF50;color:white;">Signup</button>
        <p id="msg" style="color:red;"></p>
    </div>

    <div id="dashboard">
        <h2>Welcome</h2>
        <p><b>Email:</b> <span id="u_email"></span></p>
        <p><b>Score:</b> <span id="u_score"></span></p>
        <p><b>Coins:</b> <span id="u_coins"></span></p>
        <button id="logoutBtn" style="background:#e74c3c;color:white;">Logout</button>
    </div>

</div>

<script type="module">
    // ---------------------- FIREBASE INIT -----------------------

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, 
             createUserWithEmailAndPassword, signOut } 
    from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import { getDatabase, ref, set, get } 
    from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBDovmAk88JUEjeY35T-3eIta1igiE5fQ0",
      authDomain: "comhashgame.firebaseapp.com",
      databaseURL: "https://comhashgame-default-rtdb.firebaseio.com",
      projectId: "comhashgame",
      storageBucket: "comhashgame.firebasestorage.app",
      messagingSenderId: "392187080052",
      appId: "1:392187080052:web:3e31391442ca1315dc1021",
      measurementId: "G-0YWTXYJ7RN"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    const loginBox = document.getElementById("login");
    const dashBox = document.getElementById("dashboard");
    const msg = document.getElementById("msg");

    // ---------------------- AUTH LISTENER -----------------------

    onAuthStateChanged(auth, async (user) => {
        if (!user) {
            loginBox.style.display = "block";
            dashBox.style.display = "none";
            return;
        }

        // User logged in â†’ Load data
        const snap = await get(ref(db, "users/" + user.uid));
        const data = snap.exists() ? snap.val() : {};

        document.getElementById("u_email").innerText = user.email;
        document.getElementById("u_score").innerText = data.score ?? 0;
        document.getElementById("u_coins").innerText = data.coins ?? 0;

        loginBox.style.display = "none";
        dashBox.style.display = "block";
    });

    // ---------------------- LOGIN -----------------------

    document.getElementById("loginBtn").onclick = async () => {
        msg.innerText = "";
        try {
            await signInWithEmailAndPassword(auth,
                email.value,
                pass.value
            );
        } catch (e) { msg.innerText = e.message; }
    };

    // ---------------------- SIGNUP -----------------------

    document.getElementById("signupBtn").onclick = async () => {
        msg.innerText = "";
        try {
            const user = await createUserWithEmailAndPassword(auth,
                email.value,
                pass.value
            );
            await set(ref(db, "users/" + user.user.uid), {
                email: user.user.email,
                score: 0,
                coins: 0
            });
        } catch (e) { msg.innerText = e.message; }
    };

    // ---------------------- LOGOUT -----------------------

    document.getElementById("logoutBtn").onclick = () => {
        signOut(auth);
    };

</script>
</body>
</html>
